{"version":3,"file":"index.js","sources":["../../../../src/hooks/use-clipboard/index.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/prefer-regexp-exec */\n\nimport { useCallback, useRef } from 'react';\nimport { CAN_USE_DOM } from '../../utils/can-use-dom';\n\nlet clipboardID = 0;\nconst textareaIdentifierKey = 'usableReactClipboardHook';\n\n/**\n * Copies text to the native clipboard, either via the `navigator.clipboard`\n * API, or old `document.execCommand('copy')` hacks!\n *\n * Based on this excellent StackOverflow answer:\n * https://stackoverflow.com/a/45308151\n */\nasync function copyToClipboard(text: string) {\n  try {\n    await navigator.clipboard.writeText(text);\n  } catch {\n    const activeEl = document.activeElement as HTMLElement;\n    const textarea = document.createElement('textarea');\n\n    // Make sure we can detect this element\n    textarea.dataset[textareaIdentifierKey] = `clipboard-${++clipboardID}`;\n\n    // Move it off-screen.\n    textarea.style.position = 'absolute';\n    textarea.style.left = '-2147483647em';\n\n    // Set to readonly to prevent mobile devices opening a keyboard when\n    // text is .select()'ed.\n    textarea.setAttribute('readonly', true as any);\n\n    document.body.appendChild(textarea);\n\n    textarea.value = text;\n\n    // Check if there is any content selected previously.\n    const selected = (document.getSelection()?.rangeCount ?? NaN) > 0 ? document.getSelection()?.getRangeAt(0) : false;\n\n    // iOS Safari blocks programmatic execCommand copying normally, without this hack.\n    // https://stackoverflow.com/questions/34045777/copy-to-clipboard-using-javascript-in-ios\n    if (navigator.userAgent.match(/ipad|ipod|iphone/i)) {\n      const editable = textarea.contentEditable;\n      textarea.contentEditable = true as any;\n      const range = document.createRange();\n      range.selectNodeContents(textarea);\n      const selection = window.getSelection();\n      selection?.removeAllRanges();\n      selection?.addRange(range);\n      textarea.setSelectionRange(0, 999999);\n      textarea.contentEditable = editable;\n    } else {\n      textarea.select();\n    }\n\n    document.execCommand('copy');\n\n    // Restore previous selection\n    if (selected) {\n      document.getSelection()?.removeAllRanges();\n      document.getSelection()?.addRange(selected);\n    }\n\n    // Restore previous focus\n    if (activeEl && activeEl.focus && isEphemeralCopyToClipboardTextarea(document.activeElement)) {\n      activeEl.focus();\n    }\n  }\n}\n\n/**\n * As a fallback when `navigator.clipboard` is unavailable, we create an\n * ephemeral <textarea> to perform the copy operation. In some cases, we want to\n * identify this <textarea> so that we can act accordingly to focus changes\n * (while copying, the <textarea> momentarily steals focus).\n *\n * The validation check performed by this function is naive, returning `true` if\n * a known dataset value is attached to the given `element`.\n */\nfunction isEphemeralCopyToClipboardTextarea(element: any): element is HTMLTextAreaElement {\n  return !!element.dataset?.[textareaIdentifierKey];\n}\n\ninterface CopyFn {\n  (source?: string): void;\n  (source?: Event): void;\n  (source?: any): void;\n}\n\ninterface OnCopyHandler {\n  (value: string): void;\n}\n\n/**\n * Creates a memoized callback—`copy`—that interacts with the user's computer clipboard.\n * Also provides a `ref` to attach to inputs, which can then be used as a source\n * for the clipboard value.\n */\nfunction useClipboardImpl(onCopy?: OnCopyHandler) {\n  const ref = useRef<HTMLInputElement | null>(null);\n\n  const copy = useCallback<CopyFn>(\n    async (source?: any) => {\n      if (!CAN_USE_DOM) return;\n\n      const text =\n        typeof source === 'string'\n          ? String(source)\n          : (ref.current as HTMLInputElement)?.value ?? ref.current?.textContent ?? source?.target?.value ?? '';\n\n      await copyToClipboard(text);\n\n      if (onCopy) onCopy(text);\n    },\n    [onCopy],\n  );\n\n  return { copy, ref };\n}\n\nexport const useClipboard = /* @__PURE__ */ Object.assign(useClipboardImpl, { isEphemeralCopyToClipboardTextarea });\n"],"names":["useRef","useCallback","CAN_USE_DOM"],"mappings":"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"}