{"version":3,"file":"create-hash.js","sources":["../../../../src/hooks/use-hash/create-hash.ts"],"sourcesContent":["/* eslint-disable no-underscore-dangle */\n\n/*\n  This code is modified from the `object-hash` NPM package. It's a great\n  package, but due to the way it's bundled for distribution, the entire `crypto`\n  module is used, even though only a small subset of APIs are required. This\n  inflates the package size by quite a lot! To reduce the size of the\n  dependency, the `crypto` module is \"tree-shaken\" by `microbundle` and only the\n  essentials of the `object-hash` API are included.\n\n  @see https://www.npmjs.com/package/object-hash\n  @see https://github.com/puleos/object-hash\n  @see https://github.com/puleos/object-hash/issues/91\n */\n\nimport { createHash as nodeCreateHash, Hash } from 'crypto';\n\n/** Check if the given function is a native function */\nfunction isNativeFunction(f: any) {\n  if (typeof f !== 'function') return false;\n  const exp = /^function\\s+\\w*\\s*\\(\\s*\\)\\s*{\\s+\\[native code\\]\\s+}$/i;\n  return exp.exec(Function.prototype.toString.call(f)) != null;\n}\n\nexport function createHash<T>(object: T) {\n  const hashingStream = nodeCreateHash('md5');\n  const { dispatch } = typeHasher(hashingStream);\n  dispatch(object);\n\n  if (!hashingStream.update) hashingStream.end('');\n  if (hashingStream.digest) return hashingStream.digest('hex');\n\n  const buf = hashingStream.read();\n  return buf.toString('hex');\n}\n\nfunction typeHasher(writeTo: Hash) {\n  const context: any[] = [];\n\n  const write = (str: string) => {\n    if (writeTo.update) writeTo.update(str, 'utf8');\n    writeTo.write(str, 'utf8');\n  };\n\n  const dispatch = (value: any) => {\n    const type = value === null ? 'null' : typeof value;\n    (typeHandlers as any)[`_${type}`](value);\n  };\n\n  const typeHandlers = {\n    _object(object: any) {\n      const pattern = /\\[object (.*)\\]/i;\n      const objString = Object.prototype.toString.call(object);\n      const execArr = pattern.exec(objString);\n      const objType = execArr ? execArr[1].toLowerCase() : `unknown:[${objString}]`.toLowerCase();\n\n      const objectNumber = context.indexOf(object);\n      if (objectNumber >= 0) dispatch(`[CIRCULAR:${objectNumber}]`);\n      context.push(object);\n\n      if (typeof Buffer !== 'undefined' && Buffer.isBuffer && Buffer.isBuffer(object)) {\n        write('buffer:');\n        write(object.toString('hex'));\n      }\n\n      if (objType !== 'object' && objType !== 'function' && objType !== 'asyncfunction') {\n        if ((typeHandlers as any)[`_${objType}`]) {\n          (typeHandlers as any)[`_${objType}`](object);\n        } else {\n          write(`[${objType}]`);\n        }\n      } else {\n        const keys = Object.keys(object)\n          .sort()\n          .splice(0, 0, 'prototype', '__proto__', 'constructor');\n        write(`object:${keys.length}:`);\n\n        keys.forEach(key => {\n          dispatch(key);\n          write(':');\n          write(',');\n        });\n      }\n    },\n    _array(arr: any[]) {\n      write(`array:${arr.length}:`);\n      arr.forEach(dispatch);\n    },\n    _date(date: Date) {\n      write(`date:${date.toJSON()}`);\n    },\n    _symbol(sym: symbol) {\n      write(`symbol:${sym.toString()}`);\n    },\n    _error(err: Error) {\n      write(`error:${err.toString()}`);\n    },\n    _boolean(bool: boolean) {\n      write(`bool:${bool.toString()}`);\n    },\n    _string(string: string) {\n      write(`string:${string.length}:`);\n      write(string.toString());\n    },\n    _function(fn: Function) {\n      write('fn:');\n      if (isNativeFunction(fn)) dispatch('[native]');\n      else dispatch(fn.toString());\n      dispatch(`function-name:${String(fn.name)}`);\n      this._object(fn);\n    },\n    _number(number: number) {\n      write(`number:${number.toString()}`);\n    },\n    _xml(xml: any) {\n      write(`xml:${xml.toString()}`);\n    },\n    _null() {\n      write('Null');\n    },\n    _undefined() {\n      write('Undefined');\n    },\n    _regexp(regex: RegExp) {\n      write(`regex:${regex.toString()}`);\n    },\n    _uint8array(arr: Uint8Array) {\n      write('uint8array:');\n      dispatch(Array.prototype.slice.call(arr));\n    },\n    _uint8clampedarray(arr: Uint8ClampedArray) {\n      write('uint8clampedarray:');\n      dispatch(Array.prototype.slice.call(arr));\n    },\n    _int8array(arr: Int8Array) {\n      write('uint8array:');\n      dispatch(Array.prototype.slice.call(arr));\n    },\n    _uint16array(arr: Uint16Array) {\n      write('uint16array:');\n      dispatch(Array.prototype.slice.call(arr));\n    },\n    _int16array(arr: Int16Array) {\n      write('uint16array:');\n      dispatch(Array.prototype.slice.call(arr));\n    },\n    _uint32array(arr: Uint32Array) {\n      write('uint32array:');\n      dispatch(Array.prototype.slice.call(arr));\n    },\n    _int32array(arr: Int32Array) {\n      write('uint32array:');\n      dispatch(Array.prototype.slice.call(arr));\n    },\n    _float32array(arr: Float32Array) {\n      write('float32array:');\n      dispatch(Array.prototype.slice.call(arr));\n    },\n    _float64array(arr: Float64Array) {\n      write('float64array:');\n      dispatch(Array.prototype.slice.call(arr));\n    },\n    _arraybuffer(arr: ArrayBuffer) {\n      write('arraybuffer:');\n      dispatch(new Uint8Array(arr));\n    },\n    _url(url: URL) {\n      write(`url:${url.toString()}`);\n    },\n    _map(map: Map<any, any>) {\n      write('map:');\n      const arr = Array.from(map);\n      typeHandlers._array(arr);\n    },\n    _set(set: Set<any>) {\n      write('set:');\n      const arr = Array.from(set);\n      typeHandlers._array(arr);\n    },\n    _blob() {\n      write('[blob]');\n    },\n    _domwindow() {\n      write('domwindow');\n    },\n  };\n\n  return { dispatch };\n}\n"],"names":["nodeCreateHash"],"mappings":"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"}