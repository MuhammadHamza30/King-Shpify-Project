import { useRef, useCallback, useMemo, useEffect } from 'react';
import { useIsMounted } from '../use-is-mounted/index.js';

/**
 * Makes asynchronous work inside the React lifecycle easy with automatic guards
 * against updating internal component state if the component is unmounted
 * before the async work is finished.
 */
function useAsyncEffect(handler, deps) {
    var thenCallback = useRef();
    var registerThenCb = useCallback(function (onfulfilled) {
        thenCallback.current = onfulfilled;
        return chain;
    }, []);
    var catchCallback = useRef();
    var registerCatchCb = useCallback(function (onrejected) {
        catchCallback.current = onrejected;
        return chain;
    }, []);
    var finallyCallback = useRef();
    var registerFinallyCb = useCallback(function (onsettled) {
        finallyCallback.current = onsettled;
        return chain;
    }, []);
    var cleanupCallback = useRef();
    var registerCleanupCb = useCallback(function (oncleanup) {
        cleanupCallback.current = oncleanup;
        return chain;
    }, []);
    var chain = useMemo(function () {
        return {
            fullfilled: registerThenCb,
            rejected: registerCatchCb,
            settled: registerFinallyCb,
            cleanup: registerCleanupCb,
        };
    }, []);
    var isMounted = useIsMounted();
    useEffect(function () {
        var context = {};
        handler(context)
            .then(function (value) {
            if (isMounted() && thenCallback.current)
                thenCallback.current(value, context);
        })
            .catch(function (err) {
            if (isMounted() && catchCallback.current)
                catchCallback.current(err, context);
        })
            .finally(function () {
            if (isMounted() && finallyCallback.current)
                finallyCallback.current(context);
        });
        if (cleanupCallback.current)
            return function () { return cleanupCallback.current(context); };
        return undefined;
    }, deps);
    return chain;
}

export { useAsyncEffect };
//# sourceMappingURL=index.js.map
