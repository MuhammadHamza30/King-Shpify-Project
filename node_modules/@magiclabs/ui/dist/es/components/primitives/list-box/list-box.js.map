{"version":3,"file":"list-box.js","sources":["../../../../../src/components/primitives/list-box/list-box.tsx"],"sourcesContent":["import type { AriaListBoxOptions } from '@react-aria/listbox';\nimport type { Node } from '@react-types/shared';\nimport composeRefs from '@seznam/compose-react-refs';\nimport { motion } from 'framer-motion';\nimport React, { createContext, useContext, useEffect, useMemo, useRef } from 'react';\nimport { useFocusRing, useListBox, useOption as useOptionAria } from 'react-aria';\nimport { ListProps, ListState, useListState } from 'react-stately';\nimport { createFramerTransition } from '../../../hooks/transitions';\nimport { clsx } from '../../../libs/clsx';\nimport { validateCollection } from '../../../libs/collections';\nimport { createErrorWithCode } from '../../../libs/exceptions';\nimport { createGenericComponent } from '../../../libs/generic-component';\nimport { mergeProps } from '../../../libs/merge-props';\n\nimport styles from './list-box.less';\n\nconst listboxTransition = /* @__PURE__ */ createFramerTransition().withVariants({\n  initial: {\n    opacity: 0,\n    scale: 0.96,\n    rotateX: '-7deg',\n    rotateY: '0deg',\n    transformOrigin: 'top center',\n    transition: { type: 'tween', ease: 'easeInOut', duration: 0.2 },\n    perspective: '500px',\n  },\n\n  animate: {\n    opacity: 1,\n    scale: 1,\n    rotateX: '0deg',\n    rotateY: '0deg',\n    transition: { type: 'tween', ease: 'easeInOut', duration: 0.2 },\n    perspective: '500px',\n  },\n});\n\ninterface ListBoxContext<T extends object = object> {\n  state?: ListState<T>;\n  ref?: React.MutableRefObject<HTMLUListElement | null>;\n}\n\nexport const ListBoxContext = /* @__PURE__ */ createContext<ListBoxContext | null>(null);\n\ninterface ListBoxProps<T extends object> extends ListProps<T>, AriaListBoxOptions<T> {\n  minHeight?: React.CSSProperties['maxHeight'];\n  maxHeight?: React.CSSProperties['maxHeight'];\n}\n\nfunction ListBoxRender<T extends object>(props: ListBoxProps<T>) {\n  const { label, minHeight, maxHeight } = props;\n\n  // Validate props & children\n  if (!label && !props['aria-label'] && !props['aria-labelledby']) {\n    throw createErrorWithCode(\n      'LIST_BOX_MISSING_ACCESSIBILTY_LABEL',\n      GenericListBox,\n      'If you do not provide a visible `label`, you must specify an `aria-label` or `aria-labelledby` attribute for accessibility',\n    );\n  }\n\n  const validCollectionChildren = validateCollection(props, GenericListBox);\n\n  // Create listbox state & refs\n  const { state: contextualState, ref: contextualRef } = useContext(ListBoxContext) ?? ({} as ListBoxContext);\n  const listboxRef = useRef<HTMLUListElement | null>(null);\n  const state = contextualState ?? useListState({ ...props, children: validCollectionChildren });\n  const { listBoxProps, labelProps } = useListBox(props, state, listboxRef);\n\n  // listbox animation\n  const getListBoxTransitionProps = listboxTransition.use({\n    initial: 'initial',\n    animate: 'animate',\n    exit: 'initial',\n  });\n\n  return (\n    <motion.div className={styles.ListBox} {...getListBoxTransitionProps()}>\n      {label && <div {...mergeProps({ className: styles.label }, labelProps)}>{label}</div>}\n      <ul {...listBoxProps} style={{ minHeight, maxHeight }} ref={composeRefs(listboxRef, contextualRef)}>\n        {[...state.collection].map((item) => (\n          <Option key={item.key} item={item} state={state} />\n        ))}\n      </ul>\n    </motion.div>\n  );\n}\n\nconst OptionContext = /* @__PURE__ */ createContext<{\n  isFocused: boolean;\n  isSelected: boolean;\n  isPressed: boolean;\n  isDisabled: boolean;\n}>({ isFocused: false, isSelected: false, isPressed: false, isDisabled: false });\n\nexport function useOption() {\n  return useContext(OptionContext);\n}\n\ninterface OptionProps<T extends object> {\n  item: Node<T>;\n  state: ListState<T>;\n}\n\nfunction Option<T extends object>(props: OptionProps<T>) {\n  const { item, state } = props;\n\n  // Derive option state and create refs\n  const ref = React.useRef<HTMLLIElement | null>(null);\n  const { optionProps, isFocused, isSelected, isPressed, isDisabled } = useOptionAria({ key: item.key }, state, ref);\n  const { isFocusVisible, focusProps } = useFocusRing();\n\n  // Create a context wrapping items with critical metadata\n  const ctx = useMemo(\n    () => ({ isFocused, isSelected, isPressed, isDisabled }),\n    [isFocused, isSelected, isPressed, isDisabled],\n  );\n\n  useEffect(() => {\n    if (isFocused) {\n      ref.current?.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' });\n    }\n  }, [isFocused]);\n\n  const isInListBoxContext = !!useContext(ListBoxContext);\n\n  return (\n    <OptionContext.Provider value={ctx}>\n      <li\n        {...mergeProps(\n          {\n            className: clsx(\n              styles.Option,\n              isSelected && styles.selected,\n              isFocused && (isFocusVisible || isInListBoxContext) && styles.focused,\n            ),\n          },\n          optionProps,\n          focusProps,\n        )}\n        ref={ref}\n      >\n        {item.rendered}\n      </li>\n    </OptionContext.Provider>\n  );\n}\n\nconst GenericListBox = /* @__PURE__ */ createGenericComponent('ListBox', ListBoxRender);\n\nexport const ListBox = /* @__PURE__ */ Object.assign(GenericListBox, { useOption });\n"],"names":["styles","useOptionAria"],"mappings":"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"}