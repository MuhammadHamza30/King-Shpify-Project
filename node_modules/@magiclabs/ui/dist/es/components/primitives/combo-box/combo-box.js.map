{"version":3,"file":"combo-box.js","sources":["../../../../../src/components/primitives/combo-box/combo-box.tsx"],"sourcesContent":["import { ComboBoxProps as BaseComboBoxProps } from '@react-types/combobox';\nimport { AnimatePresence } from 'framer-motion';\nimport React, { MutableRefObject, useEffect, useMemo, useRef, useState } from 'react';\nimport { DismissButton, FocusScope, useButton, useComboBox, useFilter, useOverlay, useSearchField } from 'react-aria';\nimport { ComboBoxState, useComboBoxState, useSearchFieldState } from 'react-stately';\nimport { clsx } from '../../../libs/clsx';\nimport { validateCollection } from '../../../libs/collections';\nimport { createGenericComponent } from '../../../libs/generic-component';\nimport { mergeProps } from '../../../libs/merge-props';\nimport { Icon, MonochromeIcons } from '../../icons';\nimport { Flex, Outset } from '../../layout';\nimport { useTheme } from '../../theme-provider/use-theme';\nimport { ListBox, ListBoxContext, useOption } from '../list-box/list-box';\nimport { TextField } from '../text-field/text-field';\n\nimport styles from './combo-box.less';\n\ninterface ComboBoxProps<T extends object> extends BaseComboBoxProps<T> {\n  label?: string;\n  filter?: (item: T, filter: string) => boolean;\n  size?: 'sm' | 'md' | 'lg';\n  showMenuButton?: boolean;\n  showSearchIcon?: boolean;\n  menuMinHeight?: React.CSSProperties['minHeight'];\n  menuMaxHeight?: React.CSSProperties['maxHeight'];\n  autoSelect?: boolean;\n}\n\nfunction ComboBoxRender<T extends object>(props: ComboBoxProps<T>) {\n  const {\n    filter: customFilter,\n    size = 'md',\n    showMenuButton,\n    showSearchIcon,\n    menuMinHeight,\n    menuMaxHeight,\n    inputValue,\n    defaultInputValue,\n\n    /**\n     * If true, the input contents will be selected on focus.\n     */\n    autoSelect,\n    ...propsWithoutCustom\n  } = props;\n\n  const { items, label, isRequired } = props;\n\n  const validCollectionChildren = validateCollection(propsWithoutCustom, GenericComboBox);\n\n  // --- Advanced use-case: custom `items` filtering\n\n  const [filterValue, setFilterValue] = useState<string | undefined>(defaultInputValue);\n  const filteredItems = useMemo(() => {\n    if (items && customFilter) {\n      return Array.from(items)\n        .filter(Boolean)\n        .filter((item) => {\n          return customFilter(item, filterValue ?? '');\n        });\n    }\n\n    return undefined;\n  }, [items, customFilter, filterValue]);\n\n  // --- State, props, and refs containing accessibility metadata for use with the combo-box\n\n  const inputRef = useRef<HTMLInputElement | null>(null);\n  const listBoxRef = useRef<HTMLUListElement | null>(null);\n  const popoverRef = useRef<HTMLDivElement | null>(document.createElement('div'));\n  const buttonRef = useRef<HTMLButtonElement | null>(null);\n\n  const state = useComboBoxState({\n    ...mergeProps(propsWithoutCustom, {\n      inputValue: inputValue ?? filterValue,\n      onInputChange: setFilterValue,\n    }),\n    items: filteredItems || items,\n    children: validCollectionChildren,\n    defaultFilter: useFilter({ sensitivity: 'base' }).contains,\n  });\n\n  const {\n    buttonProps: triggerProps,\n    inputProps,\n    listBoxProps,\n    labelProps,\n  } = useComboBox(\n    {\n      ...propsWithoutCustom,\n      inputRef,\n      listBoxRef,\n      popoverRef,\n      buttonRef: showMenuButton ? buttonRef : undefined,\n    },\n    state,\n  );\n\n  // If the `autoSelect` prop is set, we'll select the input contents whenever\n  // the combobox gets focus.\n  useEffect(() => {\n    if (state.isFocused && autoSelect) {\n      inputRef.current?.select();\n    }\n  }, [state.isFocused, autoSelect]);\n\n  // Props for an menu trigger button; currently unused...\n  const { buttonProps } = useButton(triggerProps, buttonRef);\n\n  // --- Manage listbox overlay state\n\n  const { overlayProps } = useOverlay(\n    {\n      isOpen: state.isOpen,\n      onClose: state.close,\n      shouldCloseOnBlur: true,\n      isDismissable: false,\n    },\n\n    popoverRef,\n  );\n\n  // --- Pass the combo-box state and ref to the `ListBox` via React context\n\n  const listBoxCtx = useMemo(\n    () => ({\n      state,\n      ref: listBoxRef,\n    }),\n    [state, listBoxRef],\n  );\n\n  const theme = useTheme();\n\n  return (\n    <div className={styles.ComboBox}>\n      {label && (\n        <>\n          <label className={clsx([styles.ComboBoxLabel, styles[`size_${size}`]])} {...labelProps}>\n            <Flex.Row alignItems=\"center\">\n              <Outset right={3} trim=\"horizontal\">\n                <span>{label}</span>\n                {isRequired && <Icon size={10} color={theme.hex.primary.base} type={MonochromeIcons.AsteriskBold} />}\n              </Outset>\n            </Flex.Row>\n          </label>\n        </>\n      )}\n\n      <TextField\n        {...mergeProps(inputProps)}\n        size={size}\n        prefix={!!showSearchIcon && <Icon style={{ opacity: 0.5 }} size={14} type={MonochromeIcons.Search} />}\n        suffix={!!state.inputValue.length && <ClearInputButton state={state} inputRef={inputRef} />}\n        addonAfter={\n          showMenuButton && (\n            <TextField.AddonButton {...buttonProps} ref={buttonRef}>\n              <Icon size={14} type={state.isOpen ? MonochromeIcons.CaretUp : MonochromeIcons.CaretDown} />\n            </TextField.AddonButton>\n          )\n        }\n        ref={inputRef}\n      />\n\n      <AnimatePresence>\n        {state.isOpen && (\n          <FocusScope restoreFocus>\n            <div className={styles.listboxContainer} {...overlayProps} ref={popoverRef}>\n              <ListBoxContext.Provider value={listBoxCtx}>\n                <ListBox {...listBoxProps} minHeight={menuMinHeight} maxHeight={menuMaxHeight}>\n                  {}\n                </ListBox>\n              </ListBoxContext.Provider>\n              <DismissButton onDismiss={state.close} />\n            </div>\n          </FocusScope>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\ninterface ClearInputButtonProps {\n  state: ComboBoxState<any>;\n  inputRef: MutableRefObject<HTMLInputElement | null>;\n}\n\nconst ClearInputButton: React.FC<ClearInputButtonProps> = (props) => {\n  const { state, inputRef } = props;\n\n  const searchProps = {\n    // label doesn't matter because we use `aria-hidden=true`;\n    // just need this to silence the warning from `react-aria`\n    'aria-label': 'n/a',\n    value: state.inputValue,\n    onChange: (v: string) => state.setInputValue(v),\n  };\n\n  const searchState = useSearchFieldState(searchProps);\n  const { clearButtonProps } = useSearchField(searchProps, searchState, inputRef);\n  const clearButtonRef = React.useRef(null);\n  const { buttonProps } = useButton(clearButtonProps, clearButtonRef);\n\n  return (\n    <button {...mergeProps({ className: styles.ClearInputButton }, buttonProps)} tabIndex={-1} aria-hidden=\"true\">\n      <Icon size={14} type={MonochromeIcons.Remove} />\n    </button>\n  );\n};\n\nconst GenericComboBox = /* @__PURE__ */ createGenericComponent('ComboBox', ComboBoxRender);\n\nexport const ComboBox = /* @__PURE__ */ Object.assign(GenericComboBox, {\n  useOption,\n});\n"],"names":["styles","MonochromeIcons.AsteriskBold","MonochromeIcons.Search","MonochromeIcons.CaretUp","MonochromeIcons.CaretDown","MonochromeIcons.Remove"],"mappings":"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"}