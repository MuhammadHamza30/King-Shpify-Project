import React, { useContext, createContext, useRef, useCallback } from 'react';
import { VisuallyHidden } from 'react-aria';
import { useForceUpdate } from 'usable-react';
import { createErrorWithCode } from '../../libs/exceptions.js';

let msgKey = 0;
const msgLimit = 25; // Keep # of most recent messages rendered in the DOM.
const AnnouncerContext = /* @__PURE__ */ createContext(() => {
    throw createErrorWithCode('ANNOUNCER_PROVIDER_REQUIRED', 'useAnnouncer', `Before the result of \`useAnnouncer\` can be utilized, you must wrap your application with \`<ThemeProvider>\`.`);
});
const Announcer = (props) => {
    const { children } = props;
    const politeMessages = useRef([]);
    const assertiveMessages = useRef([]);
    const forceUpdate = useForceUpdate();
    const announce = useCallback((message, options) => {
        switch (options === null || options === void 0 ? void 0 : options.type) {
            case 'assertive': {
                assertiveMessages.current = [
                    ...assertiveMessages.current.slice(Math.max(assertiveMessages.current.length - msgLimit, 0)),
                    React.createElement("div", { key: ++msgKey }, message),
                ];
                break;
            }
            case 'polite':
            default: {
                politeMessages.current = [
                    ...politeMessages.current.slice(Math.max(politeMessages.current.length - msgLimit, 0)),
                    React.createElement("div", { key: ++msgKey }, message),
                ];
                break;
            }
        }
        forceUpdate();
    }, []);
    return (React.createElement(AnnouncerContext.Provider, { value: announce },
        React.createElement(MessageBlock, { type: "polite" }, politeMessages.current),
        React.createElement(MessageBlock, { type: "assertive" }, assertiveMessages.current),
        children));
};
Announcer.displayName = 'Announcer';
const MessageBlock = (props) => {
    const { children, type = 'polite', relevant = 'additions' } = props;
    return (React.createElement(VisuallyHidden, null,
        React.createElement("div", { role: "log", "aria-live": type, "aria-relevant": relevant }, children)));
};
MessageBlock.displayName = 'MessageBlock';
function useAnnouncer() {
    return useContext(AnnouncerContext);
}

export { Announcer, useAnnouncer };
//# sourceMappingURL=announcer.js.map
