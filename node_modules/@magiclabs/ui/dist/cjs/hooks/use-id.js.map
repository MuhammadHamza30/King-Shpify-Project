{"version":3,"file":"use-id.js","sources":["../../../src/hooks/use-id.ts"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport { useSSRSafeId } from '@react-aria/ssr';\nimport { useIsomorphicLayoutEffect } from './use-isomorphic-layout-effect';\n\nconst map: Map<string, (v: string) => void> = new Map();\n\n/**\n * If a default is not provided, generates an ID.\n *\n * Based on `useId` utility from `@react-aria/utils`\n *\n * @see the LICENSE file at the root of this source tree:\n *   https://github.com/adobe/react-spectrum/blob/main/packages/@react-aria/utils/src/useId.ts\n *\n * Modifications from original source:\n *   - Uses our internal `use-isomorphic-layout-effect` hook\n */\nexport function useID(defaultID?: string): string {\n  const isRendering = useRef(true);\n  isRendering.current = true;\n\n  const [value, setValue] = useState(defaultID);\n  const nextId = useRef<string | null>(null);\n\n  // Don't memo this, we want it new each render so that the Effects always run\n  const updateValue = (val: string) => {\n    if (!isRendering.current) {\n      setValue(val);\n    } else {\n      nextId.current = val;\n    }\n  };\n\n  useIsomorphicLayoutEffect(() => {\n    isRendering.current = false;\n  }, [updateValue]);\n\n  useEffect(() => {\n    const newId = nextId.current;\n\n    if (newId) {\n      setValue(newId);\n      nextId.current = null;\n    }\n  }, [setValue, updateValue]);\n\n  const res = useSSRSafeId(value);\n  map.set(res, updateValue);\n  return res;\n}\n\n/**\n * Merges two ids.\n *\n * Based on `mergeIds` utility from `@react-aria/utils`\n *\n * @see the LICENSE file at the root of this source tree:\n *   https://github.com/adobe/react-spectrum/blob/main/packages/@react-aria/utils/src/useId.ts\n *\n * Modifications from original source: none\n */\nexport function mergeIDs(a: string, b: string): string {\n  if (a === b) {\n    return a;\n  }\n\n  const setA = map.get(a);\n  if (setA) {\n    setA(b);\n    return b;\n  }\n\n  const setB = map.get(b);\n  if (setB) {\n    setB(a);\n    return a;\n  }\n\n  return b;\n}\n\n/**\n * Used to generate an id, and after render, check if that id is rendered so we\n * know if we can use it in places such as labelledby.\n *\n * Based on `useSlotId` utility from `@react-aria/utils`\n *\n * @see the LICENSE file at the root of this source tree:\n *   https://github.com/adobe/react-spectrum/blob/main/packages/@react-aria/utils/src/useId.ts\n *\n * Modifications from original source:\n *   - Uses our internal `use-isomorphic-layout-effect` hook\n */\nexport function useSlotID(): string {\n  const [id, setId] = useState(useID());\n\n  useIsomorphicLayoutEffect(() => {\n    const setCurr = map.get(id);\n    if (setCurr && !document.getElementById(id)) {\n      setId(null!);\n    }\n  }, [id]);\n\n  return id;\n}\n"],"names":["useRef","useState","useIsomorphicLayoutEffect","useEffect","useSSRSafeId"],"mappings":";;;;;;;;AAIA,MAAM,GAAG,GAAqC,IAAI,GAAG,EAAE,CAAC;AAExD;;;;;;;;;;AAUG;AACG,SAAU,KAAK,CAAC,SAAkB,EAAA;AACtC,IAAA,MAAM,WAAW,GAAGA,YAAM,CAAC,IAAI,CAAC,CAAC;AACjC,IAAA,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC;IAE3B,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,GAAGC,cAAQ,CAAC,SAAS,CAAC,CAAC;AAC9C,IAAA,MAAM,MAAM,GAAGD,YAAM,CAAgB,IAAI,CAAC,CAAC;;AAG3C,IAAA,MAAM,WAAW,GAAG,CAAC,GAAW,KAAI;AAClC,QAAA,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE;YACxB,QAAQ,CAAC,GAAG,CAAC,CAAC;AACf,SAAA;AAAM,aAAA;AACL,YAAA,MAAM,CAAC,OAAO,GAAG,GAAG,CAAC;AACtB,SAAA;AACH,KAAC,CAAC;IAEFE,mDAAyB,CAAC,MAAK;AAC7B,QAAA,WAAW,CAAC,OAAO,GAAG,KAAK,CAAC;AAC9B,KAAC,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC;IAElBC,eAAS,CAAC,MAAK;AACb,QAAA,MAAM,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC;AAE7B,QAAA,IAAI,KAAK,EAAE;YACT,QAAQ,CAAC,KAAK,CAAC,CAAC;AAChB,YAAA,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC;AACvB,SAAA;AACH,KAAC,EAAE,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC,CAAC;AAE5B,IAAA,MAAM,GAAG,GAAGC,gBAAY,CAAC,KAAK,CAAC,CAAC;AAChC,IAAA,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC;AAC1B,IAAA,OAAO,GAAG,CAAC;AACb,CAAC;AAED;;;;;;;;;AASG;AACa,SAAA,QAAQ,CAAC,CAAS,EAAE,CAAS,EAAA;IAC3C,IAAI,CAAC,KAAK,CAAC,EAAE;AACX,QAAA,OAAO,CAAC,CAAC;AACV,KAAA;IAED,MAAM,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACxB,IAAA,IAAI,IAAI,EAAE;QACR,IAAI,CAAC,CAAC,CAAC,CAAC;AACR,QAAA,OAAO,CAAC,CAAC;AACV,KAAA;IAED,MAAM,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACxB,IAAA,IAAI,IAAI,EAAE;QACR,IAAI,CAAC,CAAC,CAAC,CAAC;AACR,QAAA,OAAO,CAAC,CAAC;AACV,KAAA;AAED,IAAA,OAAO,CAAC,CAAC;AACX,CAAC;AAED;;;;;;;;;;;AAWG;SACa,SAAS,GAAA;IACvB,MAAM,CAAC,EAAE,EAAE,KAAK,CAAC,GAAGH,cAAQ,CAAC,KAAK,EAAE,CAAC,CAAC;IAEtCC,mDAAyB,CAAC,MAAK;QAC7B,MAAM,OAAO,GAAG,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QAC5B,IAAI,OAAO,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,EAAE;YAC3C,KAAK,CAAC,IAAK,CAAC,CAAC;AACd,SAAA;AACH,KAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AAET,IAAA,OAAO,EAAE,CAAC;AACZ;;;;;;"}