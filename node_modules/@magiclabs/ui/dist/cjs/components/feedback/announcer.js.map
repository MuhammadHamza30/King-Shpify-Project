{"version":3,"file":"announcer.js","sources":["../../../../src/components/feedback/announcer.tsx"],"sourcesContent":["import React, { AriaAttributes, PropsWithChildren, createContext, useCallback, useContext, useRef } from 'react';\nimport { VisuallyHidden } from 'react-aria';\nimport { useForceUpdate } from 'usable-react';\nimport { createErrorWithCode } from '../../libs/exceptions';\n\nlet msgKey = 0;\nconst msgLimit = 25; // Keep # of most recent messages rendered in the DOM.\n\ninterface AnnouncerFn {\n  (message: React.ReactNode, options?: { type: 'polite' | 'assertive' }): void;\n}\n\nconst AnnouncerContext = /* @__PURE__ */ createContext<AnnouncerFn>(() => {\n  throw createErrorWithCode(\n    'ANNOUNCER_PROVIDER_REQUIRED',\n    'useAnnouncer',\n    `Before the result of \\`useAnnouncer\\` can be utilized, you must wrap your application with \\`<ThemeProvider>\\`.`,\n  );\n});\n\nexport const Announcer: React.FC<PropsWithChildren> = (props) => {\n  const { children } = props;\n\n  const politeMessages = useRef<React.ReactNode[]>([]);\n  const assertiveMessages = useRef<React.ReactNode[]>([]);\n  const forceUpdate = useForceUpdate();\n\n  const announce = useCallback<AnnouncerFn>((message, options) => {\n    switch (options?.type) {\n      case 'assertive': {\n        assertiveMessages.current = [\n          ...assertiveMessages.current.slice(Math.max(assertiveMessages.current.length - msgLimit, 0)),\n          <div key={++msgKey}>{message}</div>,\n        ];\n        break;\n      }\n\n      case 'polite':\n      default: {\n        politeMessages.current = [\n          ...politeMessages.current.slice(Math.max(politeMessages.current.length - msgLimit, 0)),\n          <div key={++msgKey}>{message}</div>,\n        ];\n        break;\n      }\n    }\n\n    forceUpdate();\n  }, []);\n\n  return (\n    <AnnouncerContext.Provider value={announce}>\n      <MessageBlock type=\"polite\">{politeMessages.current}</MessageBlock>\n      <MessageBlock type=\"assertive\">{assertiveMessages.current}</MessageBlock>\n      {children}\n    </AnnouncerContext.Provider>\n  );\n};\n\nAnnouncer.displayName = 'Announcer';\n\ninterface MessageBlockProps extends PropsWithChildren {\n  type: 'polite' | 'assertive';\n  relevant?: AriaAttributes['aria-relevant'];\n}\n\nconst MessageBlock: React.FC<MessageBlockProps> = (props) => {\n  const { children, type = 'polite', relevant = 'additions' } = props;\n\n  return (\n    <VisuallyHidden>\n      <div role=\"log\" aria-live={type} aria-relevant={relevant}>\n        {children}\n      </div>\n    </VisuallyHidden>\n  );\n};\n\nMessageBlock.displayName = 'MessageBlock';\n\nexport function useAnnouncer() {\n  return useContext(AnnouncerContext);\n}\n"],"names":["createContext","createErrorWithCode","useRef","useForceUpdate","useCallback","React","VisuallyHidden","useContext"],"mappings":";;;;;;;;;;;;;AAKA,IAAI,MAAM,GAAG,CAAC,CAAC;AACf,MAAM,QAAQ,GAAG,EAAE,CAAC;AAMpB,MAAM,gBAAgB,mBAAmBA,mBAAa,CAAc,MAAK;IACvE,MAAMC,8BAAmB,CACvB,6BAA6B,EAC7B,cAAc,EACd,CAAA,+GAAA,CAAiH,CAClH,CAAC;AACJ,CAAC,CAAC,CAAC;AAEU,MAAA,SAAS,GAAgC,CAAC,KAAK,KAAI;AAC9D,IAAA,MAAM,EAAE,QAAQ,EAAE,GAAG,KAAK,CAAC;AAE3B,IAAA,MAAM,cAAc,GAAGC,YAAM,CAAoB,EAAE,CAAC,CAAC;AACrD,IAAA,MAAM,iBAAiB,GAAGA,YAAM,CAAoB,EAAE,CAAC,CAAC;AACxD,IAAA,MAAM,WAAW,GAAGC,0BAAc,EAAE,CAAC;IAErC,MAAM,QAAQ,GAAGC,iBAAW,CAAc,CAAC,OAAO,EAAE,OAAO,KAAI;AAC7D,QAAA,QAAQ,OAAO,KAAP,IAAA,IAAA,OAAO,uBAAP,OAAO,CAAE,IAAI;YACnB,KAAK,WAAW,EAAE;gBAChB,iBAAiB,CAAC,OAAO,GAAG;oBAC1B,GAAG,iBAAiB,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,iBAAiB,CAAC,OAAO,CAAC,MAAM,GAAG,QAAQ,EAAE,CAAC,CAAC,CAAC;AAC5F,oBAAAC,yBAAA,CAAA,aAAA,CAAA,KAAA,EAAA,EAAK,GAAG,EAAE,EAAE,MAAM,EAAA,EAAG,OAAO,CAAO;iBACpC,CAAC;gBACF,MAAM;AACP,aAAA;AAED,YAAA,KAAK,QAAQ,CAAC;AACd,YAAA,SAAS;gBACP,cAAc,CAAC,OAAO,GAAG;oBACvB,GAAG,cAAc,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,OAAO,CAAC,MAAM,GAAG,QAAQ,EAAE,CAAC,CAAC,CAAC;AACtF,oBAAAA,yBAAA,CAAA,aAAA,CAAA,KAAA,EAAA,EAAK,GAAG,EAAE,EAAE,MAAM,EAAA,EAAG,OAAO,CAAO;iBACpC,CAAC;gBACF,MAAM;AACP,aAAA;AACF,SAAA;AAED,QAAA,WAAW,EAAE,CAAC;KACf,EAAE,EAAE,CAAC,CAAC;IAEP,QACEA,wCAAC,gBAAgB,CAAC,QAAQ,EAAC,EAAA,KAAK,EAAE,QAAQ,EAAA;QACxCA,yBAAC,CAAA,aAAA,CAAA,YAAY,IAAC,IAAI,EAAC,QAAQ,EAAE,EAAA,cAAc,CAAC,OAAO,CAAgB;QACnEA,yBAAC,CAAA,aAAA,CAAA,YAAY,IAAC,IAAI,EAAC,WAAW,EAAE,EAAA,iBAAiB,CAAC,OAAO,CAAgB;QACxE,QAAQ,CACiB,EAC5B;AACJ,EAAE;AAEF,SAAS,CAAC,WAAW,GAAG,WAAW,CAAC;AAOpC,MAAM,YAAY,GAAgC,CAAC,KAAK,KAAI;AAC1D,IAAA,MAAM,EAAE,QAAQ,EAAE,IAAI,GAAG,QAAQ,EAAE,QAAQ,GAAG,WAAW,EAAE,GAAG,KAAK,CAAC;IAEpE,QACEA,wCAACC,wBAAc,EAAA,IAAA;AACb,QAAAD,yBAAA,CAAA,aAAA,CAAA,KAAA,EAAA,EAAK,IAAI,EAAC,KAAK,EAAA,WAAA,EAAY,IAAI,EAAA,eAAA,EAAiB,QAAQ,EAAA,EACrD,QAAQ,CACL,CACS,EACjB;AACJ,CAAC,CAAC;AAEF,YAAY,CAAC,WAAW,GAAG,cAAc,CAAC;SAE1B,YAAY,GAAA;AAC1B,IAAA,OAAOE,gBAAU,CAAC,gBAAgB,CAAC,CAAC;AACtC;;;;;"}