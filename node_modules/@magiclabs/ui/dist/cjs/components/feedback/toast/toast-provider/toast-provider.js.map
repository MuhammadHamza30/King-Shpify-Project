{"version":3,"file":"toast-provider.js","sources":["../../../../../../src/components/feedback/toast/toast-provider/toast-provider.tsx"],"sourcesContent":["import { AnimatePresence, motion } from 'framer-motion';\nimport React, { PropsWithChildren, useCallback, useMemo, useReducer, useRef } from 'react';\nimport { useIsMounted } from 'usable-react';\nimport { transitions } from '../../../../hooks/transitions';\nimport { clsx } from '../../../../libs/clsx';\nimport { Icon, MonochromeIcons } from '../../../icons';\nimport { EphemeralPortal, Flex, Inset } from '../../../layout';\nimport { ThemeProvider, useTheme } from '../../../theme-provider';\nimport { ToastContext, ToastDefinition } from '../use-toast';\n\nimport styles from './toast-provider.less';\n\nlet toastID = 0;\n\nconst toastIcons = {\n  success: () => MonochromeIcons.SuccessFilled,\n  warning: () => MonochromeIcons.Warning,\n  error: () => MonochromeIcons.Exclaim,\n  info: () => MonochromeIcons.Info,\n};\n\ninterface ToastProviderProps extends PropsWithChildren {\n  position?: 'top' | 'top-start' | 'top-end' | 'bottom' | 'bottom-start' | 'bottom-end';\n}\n\nexport const ToastProvider: React.FC<ToastProviderProps> = (props) => {\n  const { position, children } = props;\n\n  const isMounted = useIsMounted();\n  const theme = useTheme();\n  const toastsRef = useRef<ToastDefinition[]>([]);\n  const forceUpdate = useReducer((x: number) => x + 1, 0)[1];\n\n  const removeToast: ToastContext['removeToast'] = useCallback((id: number) => {\n    toastsRef.current = toastsRef.current.filter((toast) => toast.id !== id);\n    forceUpdate();\n  }, []);\n\n  const createToast: ToastContext['createToast'] = useCallback((options) => {\n    const { message, messageOnly, type = 'info', lifespan = 2000 } = options;\n    const id = ++toastID;\n\n    toastsRef.current.push({ message, messageOnly, type, id });\n    forceUpdate();\n\n    setTimeout(() => {\n      if (isMounted()) {\n        removeToast(id);\n      }\n    }, lifespan);\n\n    return id;\n  }, []);\n\n  const toastCtx = useMemo(() => ({ createToast, removeToast }), [createToast, removeToast]);\n  const getSlideProps = transitions.useSlide();\n  const toasts = position?.startsWith('top') ? [...toastsRef.current] : [...toastsRef.current].reverse();\n  const activeToasts = toasts.map((toast) => {\n    return (\n      <motion.div\n        layout\n        className={clsx([styles.toast, styles[toast.type]])}\n        data-mg-toast-id={toast.id}\n        key={toast.id}\n        aria-live={['info', 'success', 'warning'].includes(toast.type) ? 'polite' : 'assertive'}\n        {...getSlideProps({ x: 0, y: position?.startsWith('top') ? -10 : 10 })}\n      >\n        <Flex.Row vertical=\"flex-start\">\n          {!toast.messageOnly && (\n            <Inset top={2}>\n              <Icon inline={false} size={20} type={toastIcons[toast.type]()} />\n            </Inset>\n          )}\n\n          <Flex.Item shrink={0} grow={1} className={styles.message}>\n            {toast.message}\n          </Flex.Item>\n        </Flex.Row>\n      </motion.div>\n    );\n  });\n\n  return (\n    <ToastContext.Provider value={toastCtx}>\n      {children}\n\n      <EphemeralPortal>\n        <ThemeProvider theme={theme}>\n          <Inset all={40}>\n            <div className={styles.ToastNotifications}>\n              <div className={clsx([styles.toastContainer, styles[`position_${position}`]])}>\n                <AnimatePresence>{activeToasts}</AnimatePresence>\n              </div>\n            </div>\n          </Inset>\n        </ThemeProvider>\n      </EphemeralPortal>\n    </ToastContext.Provider>\n  );\n};\n"],"names":["MonochromeIcons.SuccessFilled","MonochromeIcons.Warning","MonochromeIcons.Exclaim","MonochromeIcons.Info","useIsMounted","useTheme","useRef","useReducer","useCallback","useMemo","transitions","React","motion","clsx","styles","Flex","Inset","Icon","ToastContext","EphemeralPortal","ThemeProvider","AnimatePresence"],"mappings":"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"}